---
title: "NEW FEEDING"
author: "Anthony G Ward"
date: '2022-11-20'
output: word_document
---
Feeding experiment on lampropholis guichenoti (the common garden skink).

Oviparous (egg laying) reptiles lay eggs with relatively undeveloped embryos and a large yolk mass containing enough energy to support embryonic development. The maternal investment into the offsprings development can be seen as contituting the material invested into the egg, as many reptiles have little or no maternal care. Changes in resource provsion to offsring may affect the growth and behavior of the offspring. This experiment was carried out using the the skink spexcies Lampropholis guichenoti at two temperature treatments (23, 28). There was also two yolk treatments: a control and the removal of approximately 16% of the yolk by a sterile insulin syringe. The skinks were given (usually) 30 crickets and the number of crickets eaten was recorded at day 2, 4 and 6. Growth variables such Mass,Snout vent lenght (SVL) and tail lenght were also recorded.  

A prediction may be that skinks coming from eggs with yolk removed may undergo compensatory growth. Compensatory growth or catch-up growth, is an accelerated growth of an organism following a period of slowed development, particularly as a result of nutrient deprivation. Furthermore, this catch up growth may require more food to fuel. Also, at higher temperatures the skink's metabolism increases (ectotherms), which also may require more food to fuel. Thus at the higher temperatures the amount of crickets consumed may be more noticable as the yolk deprevation and increased basal metabolism may interact.

However, other vatriables impact the amount a skink eats such as size and individual genetics and these would need to be factored in to models that attempt to unravel any eating relationships.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Library
```{r }
library(tidyverse)
library(lmerTest)
library(ggResidpanel)
library(emmeans)
```

read in data and check it has been successful

```{r }
guich <- read_csv("guich_feed_data.csv", show_col_types = FALSE)
glimpse(guich)
```

Check the sample size
```{r}
guich %>%
  group_by(yolk_trt, temp_trt) %>%
  summarise(count = n())
```
Examination of the feeding data trials. How much does each lizard weigh and how many crickets eaten? Colour by treatment (Yolk = C/A, Temp = 23/28). remove the yolk (=NA) treatment.

```{r}
eat_mass <- guich %>%
  filter(!is.na(yolk_trt)) %>%
  select(lizard_ID, yolk_trt, temp_trt, 
         trial1_mass, crickets_eaten1,
         trial2_mass, crickets_eaten2,
         trial3_mass, crickets_eaten3) %>%
  rename(trial1_crickets = "crickets_eaten1",
         trial2_crickets = "crickets_eaten2",
         trial3_crickets = "crickets_eaten3") %>%
  pivot_longer(cols = 4:9,
               names_to = c("trial","measure"),
               names_sep = "_",
               values_to = "value") %>%
  pivot_wider(names_from = "measure", values_from = "value")
```

Visualise how indidiual mass changes over the trials for the different treatments

```{r}
ggplot(eat_mass, aes(x = trial, y = mass, col = interaction(yolk_trt, temp_trt)))+
  geom_point()+
  geom_line(aes(group = lizard_ID))+
  facet_grid(yolk_trt ~ temp_trt)
```
This is a little had to view that a summary may help
summary mass changes over the trials
First a code to get a summary
```{r}
eat_mass_sum<-eat_mass%>%
  group_by(temp_trt,trial,yolk_trt) %>%
  summarise(mean_mass=mean(mass,na.rm=TRUE))
```

Visualisation of the summary plots for mass


```{r}
ggplot(eat_mass_sum, aes(x = trial, y = mean_mass, col = yolk_trt)) +
  geom_point(alpha = 0.2) +
  geom_line(aes(group=yolk_trt)) + 
  facet_wrap(~temp_trt)+
  theme(legend.title=element_blank(), legend.position = 'top') 
```

Superficially there looks like these is something going on at the higher temperature with the treatment group (compensatory growth???)

A linear model and Test for significance
A linear mixed model is a statistical model that accounts for both fixed and random effects. These can be there are repeated measurements on the same statistical units, such as a longitudinal study.

```{r}
model2 <- lmer(mass~yolk_trt*temp_trt + (1|trial)+ (1|lizard_ID), data = eat_mass)
anova(model2)
```


```{r}
resid_panel(model2)
```
The Q-Q plot, or quantile-quantile plot, is a graphical tool to help us assess if a set of data plausibly came from some theoretical distribution such as a Normal distribution. If the data is normally distributed, the points in the QQ-normal plot lie on a straight diagonal line.


```{r}
emmeans(model2, ~yolk_trt*temp_trt)
```
Although there appears to be a difference in mass at higher temperature this is not significant
Means all well within confidence limits 

Exploratory plots looking at crickets eaten
```{r}
eat_mass %>%
  filter(!is.na(yolk_trt)) %>%
ggplot(aes(x = trial, y = crickets, col = interaction(yolk_trt, temp_trt)))+
  geom_point()+
  geom_line(aes(group = lizard_ID))+
  facet_grid(yolk_trt ~ temp_trt)
```

summary plot to help to visualise

```{r}
eat_crickets_sum<-eat_mass%>%
  group_by(temp_trt,trial,yolk_trt) %>%
  summarise(mean_crickets=mean(crickets,na.rm=TRUE))
```

```{r}
ggplot(eat_crickets_sum, aes(x = trial, y = mean_crickets, col = yolk_trt)) +
  geom_point(alpha = 0.2) +
  geom_line(aes(group=yolk_trt)) + 
  facet_wrap(~temp_trt)+
  theme(legend.title=element_blank(), legend.position = 'top') 
```

Trend appears to reverse at the higher temperature.

What is the relationship between crickets eaten and mass (same trial)?

```{r}
eat_mass %>%
ggplot(aes(x = crickets, y = mass))+
  geom_point(aes(col = interaction(yolk_trt, temp_trt)))+
  geom_smooth(method = "lm")+
  facet_wrap(~trial)
```

Interesting 
Bigger skinks appear to be eat less crickets


Does skink food intake depend upon treatment (yolk or temp)?
```{r}
model1 <- lmer(crickets~yolk_trt*temp_trt + (1|trial)+ (1|lizard_ID), data = eat_mass)
anova(model1)

```



Assess model fit.
```{r}
resid_panel(model1)
```


 Evidence of an effect of treatment is insuffuicent, the ratio of the noise to signal is high (summed suraes high-lots lots of varaition within treatments??). Greater sample size may help remedy this and allow relationships to be unravelled. Obtain estimated modelled means from emmeans() function.
```{r}
emmeans(model1, ~yolk_trt*temp_trt)
```

Other factors of interest
Lizards store fat and nurients in their tails is there a difference between treatments?
Visualise data
```{r}
guich %>%
  filter(!is.na(yolk_trt)) %>%
  ggplot(aes(x=yolk_trt, y = final_tl))+ 
  geom_boxplot(aes(fill = yolk_trt))+
  geom_jitter(width = 0.2, height = 1) +
  facet_wrap(~temp_trt) 

```
means appear similar
Test with a linear mixed model (data is not longnitudinal so I am not sure if it can be applied in this case, in anycase good practise )
```{r}
model4 <- lmer(final_tl~yolk_trt*temp_trt + (1|final_svl), data = guich)
anova(model4)



```

```{r}
resid_panel(model4)
```

```{r}
emmeans(model4, ~yolk_trt*temp_trt)
```
means within CL 

what about SVL (snout vent lenghts)
Visualise the data in box plots
```{r}
guich %>%
  filter(!is.na(yolk_trt)) %>%
  ggplot(aes(x=yolk_trt, y = final_svl))+ 
  geom_boxplot(aes(fill = yolk_trt))+
  geom_jitter(width = 0.2, height = 1) +
  facet_wrap(~temp_trt) 
```

Means appea to be close.
Linear model
```{r}
model3 <- lmer(final_svl~yolk_trt*temp_trt + (1|final_tl), data = guich)
anova(model3)
```

Yolk treatment just above 0.05

```{r}
resid_panel(model3)
```

```{r}
emmeans(model3, ~yolk_trt*temp_trt)
```
Just within CL thus insuffient evience of relationship.
